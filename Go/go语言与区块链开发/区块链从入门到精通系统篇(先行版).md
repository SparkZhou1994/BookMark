# 比特币诞生背景
## 为何适合作为金融货币
### 比特币如何解决拜占庭将军问题
- 数字签名
- 最长链，因为不知道世界上有多少人在用比特币，每次以最长的链为准绳
- POW机制，作恶成本高
# 比特币介绍
## 比特币交易简单介绍
- 交易创建
- 通过网络传播
- 交易验证（签名）
- 验证结果通过网络传播（通过算力，10分钟记一次帐）
- 交易写入账本
## 与传统记账方式的对比
### 区块是什么
记录多条交易的一页账单
### 区块链是什么
按照时间顺序将多个账单装订在一起形成的账本
## 比特币和区块链关系
- 区块链是由比特币的底层支撑系统
- 区块链是从比特币抽离出来的概念，由比特币产生
## 比特币（区块链）使用
### 哈希算法
### 密码学
#### 非对称加密应用
##### 比特币地址
通过私钥使用椭圆曲线乘法这个单向加密函数产生一个公钥。有了公钥，使用一个单向加密哈希函数产生比特币地址。
公钥到比特币地址的过程
- 公钥 通过 双哈希 HASH160（SHA256 RIPEMD160）得到 公钥哈希（20字节）
- 公钥哈希通过 Base58check编码（前缀版本为0x00）得到 比特币地址
### P2P网络（用于 广播交易， 同步账本）
### 默克尔树 (用于快速验证交易)
Merkle Tree 称为 Hash Tree，存储hash值的一棵平衡二叉树
## 比特币相关参数
- 区块大小上限 1M
- 总计 2100 万枚， 2140年挖完
- 每10分钟一个区块，通过难度值调整实现
- 21万个 区块后奖励减半，大约四年，目前奖励12.5（2018年）
- 1btc = 10^8 聪明 satoshi
## 比特币区块结构
### 区块结构
|字节|字段|说明|
|:-:|:-:|:-:|
|4|区块大小||
|80|区块头||
|1-9|交易计数器|该区块包含的交易数量|
|不定|交易|交易信息，使用原生的交易信息格式，并且交易在数据流中的位置必须与Merkle树的叶子节点顺序一致|
区块大小目前严格限制在1MB内（除了区块大小）
### 区块头(Block Header)  
|字节|字段|说明|
|:-:|:-:|:-:|
|4|版本|区块版本号，表示本区块遵守的验证规则|
|32|父区块头哈希值|使用SHA256|
|32|Merkle根|该区块中交易的Merkle树根的哈希值，使用SHA256|
|4|时间戳|该区块产生的近似时间，精准到秒的UNIX时间戳，必须严格大于前11个区块时间的中值，同时全节点也会拒绝那些超出自己2个小时时间戳的区块|
|4|难度目标|该区块工作量证明算法的难度目标，已经使用特定算法编码|
|4|Nonce|为了找到满足难度目标所设定的随机数，为了解决32位随机数载算力飞升的情况下不够用的问题，规定时间戳和coinbase交易信息均可更改，以此拓展nonce的位数|
区块不存储hash值，节点接受区块后独立计算并存储在本地
### 区块体(Transactions)
- coinbase交易：第一条交易，挖矿奖励矿工
- 普通转账交易：每笔交易包括付款方、收款方、付款金额、手续费等等(后面详细讲解)
### 创世块
整个链条的第一块。hash值表示块，高度也能表示块。但同一个高度可能有多个块，产生分叉，下一个块来选择哪个最长，哪个继续链接。
## 比特币交易详细流程
- 创建交易，广播交易
- 临近节点接受交易，校验交易
- 广播该交易，并将交易放入代确认池中
- 校验结束后，等待下一个记账周期开始，所有节点竞争记账权，挖矿
- 某个节点计算成功后，向全网公布计算结果
- 其他节点校验通过后，算出结果的节点进行记账，获取比特币
- 广播自己的账本，全网各个节点同步最新账本
## 比特币交易
### 未消费输出(UTXO)
UTXO: unspent transaction output，是比特币交易中最小的支付单元，不可分割，每一个UTXO必须一次性消耗完，然后生成新的UTXO，存放在比特币网络的UTXO池中。
当一个用户接收比特币时，金额被当作UTXO记录到区块链里。这样，一个用户的比特币会被当作UTXO分散到数百个交易和数百个区块中。实际上，并不存在存储比特币地址或账户余额的地点，只有被所有者锁住的、分散的UTXO。
新的交易从UTXO集中消耗(支付)一个或多个输出。
### 交易
#### 交易结构
|大小|字段|描述|
|:-:|:-:|:-:|
|4字节|版本|明确这笔交易参考的规则|
|1-9字节|输入数量|被包含的输入的数量|
|不定|输入|一个或多个交易输入|
|1-9字节|输出数量|被包含的输出的数量|
|不定|输出|一个或多个交易输出|
|4字节|时钟时间|一个UNIX时间戳或区块号|
#### 多种交易形式
- 普通交易，一个输入一个输出，10个UTXO，8个给对方，2个给自己或者手续费
- 多对一，慈善机构收款后消费
- 一对多，公司老板发工资
#### TxInput
指明交易发起人可支付资金的来源，包含：
- 引用utxo所在交易的ID
- 所消费utxo在output中的索引(因为一个交易会有多个output，需要索引值来确定)
- 解锁脚本(签名)
#### TxOutput
包含资金接收方的相关信息，包含
- 接收金额
- 锁定脚本(收款方地址)
#### 代码查看交易(json)
### UTXO消费和产生过程
Alice向Bob支付8个BTC，由于Alice只有3BTC和6BTC的UTXO，所以需要创建一个1BTC的UTXO来找零给自己。这笔交易消耗了两个UTXO，并产生了两个新的UTXO，并由比特币系统将他们添加到比特币UTXO池中。
交易前，会遍历UTXO集，查找Alice合理的UTXO，作为输入。消费完的UTXO被销毁，新生成的UTXO被创建。
### 解决双花问题(Double-Spending)
时间戳+utxo
- 已经确认的交易时(utxo)
- 尚未确认交易时(时间戳最早的一笔)
- 被两个节点同时挖出，比特币链条会分叉
- 被两个节点同时挖出(立即化为矿工连追两个区块，变成最长链)，解决办法，等6个区块后再交付产品
### 解决拜占庭将军问题
如何对一个账本达成一致，认为这个账本是可靠的
- 数字签名
- 最长链机制
- POW保证同一时间只有一个节点记账
## 比特币存在问题
- 51%算力攻击
矿池算力集中，有操控风险，造假也只能操作自己的账户金额，因为没有别人的私钥。
- 图灵不完备
无循环语句，无法胜任复杂应用
- 区块容量太小
仅1M
- 确认周期长
需要六个区块之后才到账(1小时)
- pow耗电量太大
做无意义的运算(对比BTM)
## 区块链为什么具有革命性意义
- AI是生产力的提升
- 区块链是生产关系的变更，可能使人类的生产结构产生重大变革，淡化国家和权利机构
## 比特币颠覆性思想
- 没有账户概念
- 没有余额概念
- 转账按字节收费，非按交易面值
# 区块链
## 发展阶段
- v1.0 比特币，点对点金融支付
- v2.0 引入智能合约，ETH为代表，主要与景荣领域结合
- v3.0 区块链与社会，区块链与各个行业融合，物联网，存储，游戏，区块链+
## 协议分层
- 应用层 转账和记账等功能
- 合约层 基本代码、算法机制、智能合约
- 激励机制 发行机制、分配机制
- 共识层 POW、POS、DPOS、DBFT、其他
- 网络层 P2P 网络、传播机制、验证机制
- 数据层 区块数据、链式结构、数字签名、哈希函数、Merkel树、非对称加密
### 共识层
#### POW，Proof of Work，工作量证明，算HASH值，要求小于目标值
存在问题
- 目前比特币被主流矿池垄断，消费资源严重
- 持币人没有话语权，算力决定一切
#### POS，Proof of Stake，股权证明，根据数字货币的量和时间，来获取利息。如果发现新块，获取利息，但币龄清零。随机选取来记账。
存在问题
- 数字货币过于集中化，寡者越来越富有，散户参与积极性低
#### DPOS Delegated Proof of Stake，委托权益证明，选出n个委托人
EOS采用DPOS + PBFT(实用拜占庭容错问题)
存在问题
- 非去中性化，而是多中心化
#### POW + POS 混合模式
#### Ripple 共识机制 
#### 小蚁NEO共识机制(DBFT)
### 合约层
智能合约，在合约达成前，钱已经打到合约中
- 本质: 合同数字化
- 痛点: 之前的合约缺乏能够支持可编程合约数字系统
- 精髓: 触发支付
## 区块链特点
- 去中性化
- 不可伪造
- 不可篡改
- 不可复制
- 匿名
- 基于密码学
- 分布式
- 可溯源
- 账本公开
## 区块链按应用场景分类
- 公有链，所有人都可以随时加入，每个节点平等，开放式
- 联盟链，仅部分人参与，选定某些节点为记账人，半封闭式。如R3CEV(银行联盟)、IBM farbric项目 
- 私有链 可实现更好的权限控制，封闭式
## 区块链相关概念
### 挖矿
#### 矿池
一个软件，矿场和普通矿工接入，矿池负责打包，接入的设备负责挖矿
### 分叉
代码升级时不同社区意见发生分歧时的结果(The DAO)
分叉后会得到等量的新币种，称为糖果
- 软分叉
新老协议共同维护一条链
- 硬分叉
旧节点拒绝接收新节点创造的区块，从此分裂为两条独立的链。如以太坊分叉，分为ETC(以太经典), ETH(以太坊v神)
### 叔块
以太坊分叉后，下一个块的名称，有奖励。
比特币称为孤块，没有奖励
### 侧链
比特币中，平行于主链，弥补主链上的缺失，不会影响主链损失。
### 节点
- 轻节点
手机钱包，只存储和自己相关的交易，只存储区块头，不存储区块体
- 全节点
整个账本进行下载同步后，就是全节点
### 钱包
可以有多个钱包，可以存放多个地址
### 零知识证明
在不向对方提供任何人个信息的条件下使对方相信某个论断是正确的一种技术。
### 扩容方式
#### 隔离见证
将每笔交易中数字签名移除，从而容纳更多的交易
#### 硬分叉
# 应用领域
## 四类应用
### 数字资产
- 一般数字资产
比特币，莱特币
- 匿名数字资产
达世币(混币)，门罗币，大零币(ZCASH)
### 全球结算
瑞波币(Ripple)
### 平台类
- Golem 计算资源交易平台，用户租用算力，依赖平台参与者数量GNT
- Augur 群体智慧，市场预测平台
### 应用类
#### 智能合约
- 房屋租赁
- 设立遗嘱
- 储蓄钱包，找一个人同时提供私钥，可以拿任意钱，如果只有一个私钥，只能拿出一部分钱，如果对方作恶，可以免职。如共同签名钱包。
- 作物保险，金融衍生品，收成差有补偿，收成好有钱赚
- 金融借贷，跳过银行和律师
- 博彩发行
## 区块链适用领域
- 证券交易
- 供应链金融
- 征信体系
- 互助保险
- 公益事业
- 档案管理
- 专利保护
- 商品溯源
- 防伪
- 支付清算
# 存在问题
## 安全性问题
- 被骗无法撤销
- 打入错误地址无法找回
- 合约存在欺诈，bug等
## 存储问题，账本过大
### ipfs协议解决
- filcoin项目
- 墨客子链ipfs
### 以太坊swarm
## 私密性
地址和人一旦对上，一切资金透明，无隐私
## 意外情况
- 执行合约的风险































